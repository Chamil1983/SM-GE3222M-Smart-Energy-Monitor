;
; PlatformIO Project Configuration File for SM-GE3222M V2.0
;
; Build options: build flags, source filter
; Upload options: custom upload port, speed and extra flags
; Library options: dependencies, extra library storages
; Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[platformio]
default_envs = esp32dev

[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino

; Build options
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DENABLE_MQTT=1
    -DENABLE_MODBUS_TCP=1
    -DENABLE_MODBUS_RTU=1
    -DENABLE_WEB_SERVER=1
    -DENABLE_OTA=1
    -DFW_VERSION=\"2.0.0\"

; Monitor options
monitor_speed = 115200
monitor_filters = 
    esp32_exception_decoder
    time

; Upload options
upload_speed = 921600
upload_port = /dev/ttyUSB0

; Dependencies
lib_deps = 
    ; Async networking
    me-no-dev/AsyncTCP @ ^1.1.1
    me-no-dev/ESPAsyncWebServer @ ^1.2.3
    
    ; JSON processing
    bblanchon/ArduinoJson @ ^6.21.3
    
    ; MQTT client
    marvinroger/AsyncMqttClient @ ^0.9.0
    
    ; Time management
    ropg/ezTime @ ^0.8.3
    
    ; SPIFFS filesystem
    ; Built-in to ESP32 core
    
    ; Modbus
    ; Custom implementation in src/comm/ModbusServer.cpp
    
    ; MCP23017 I/O Expander
    adafruit/Adafruit MCP23017 Arduino Library @ ^2.3.0
    
    ; DHT sensor (if used)
    adafruit/DHT sensor library @ ^1.4.4
    
    ; LCD display
    johnrickman/LiquidCrystal I2C @ ^1.1.4
    
    ; Preferences (NVS storage)
    ; Built-in to ESP32 core

; Test options
test_build_project_src = true
test_framework = unity
test_filter = test_*

; OTA configuration
extra_scripts = 
    post:scripts/ota_upload.py

; Partition scheme (custom for OTA + SPIFFS)
board_build.partitions = partitions_custom.csv

[env:esp32dev_debug]
extends = env:esp32dev
build_type = debug
build_flags = 
    ${env:esp32dev.build_flags}
    -DCORE_DEBUG_LEVEL=5
    -DDEBUG=1

[env:esp32dev_release]
extends = env:esp32dev
build_type = release
build_flags = 
    ${env:esp32dev.build_flags}
    -DCORE_DEBUG_LEVEL=1
    -O2

; OTA update environment
[env:esp32dev_ota]
extends = env:esp32dev
upload_protocol = espota
upload_port = ge3222m.local
upload_flags = 
    --port=3232
    --auth=admin
